<<<<<<< HEAD
<<<<<<< HEAD
define(["jquery","core/log","core/config"],function(a,b,c){var d={eulas:"required",shopid:0,init:function(c){a(".shop-description-toggle").bind("click",this.toggle_description),c&&(d.shopid=c.shopid),b.debug("AMD Local Shop Front initialized")},initeulas:function(c){a("#shop-eula-confirm").bind("click",this.accept_eulas),c&&("required"===c.eulas&&a("#region-pre").css("display","none"),d.eulas=c.eulas),b.debug("AMD Local Shop Front Eulas initialized")},toggle_description:function(){var b=a(this);b.attr("src").match(/open/)?(b.attr("src",b.attr("src").replace("open","close")),b.parent().parent().children(".shop-front-description").removeClass("shop-desc-gradient")):(b.attr("src",b.attr("src").replace("close","open")),b.parent().parent().children(".shop-front-description").addClass("shop-desc-gradient"))},accept_eulas:function(){var b;1==a("#shop-agreeeula").val()?(a("#euladiv").css("display","none"),a("#order").css("display","block"),a("#order").css("visibility","show"),a("#region-pre").css("display","block"),a("#region-pre").css("visibility","show"),b=c.wwwroot+"/local/shop/front/ajax/service.php?what=agreeeulas",b+="&service=order",b+="&id="+d.shopid):(b=c.wwwroot+"/local/shop/front/ajax/service.php?what=reseteulas",b+="&service=order",b+="&id="+d.shopid),a.get(b)},reset_eulas:function(){if("agreed"==d.eulas){var b=c.wwwroot+"/local/shop/front/ajax/service.php?what=reseteulas";b+="&service=order",b+="&id="+d.shopid,a.get(b)}}};return d});
=======
define ("local_shop/front",["jquery","core/log","core/config","core/str"],function(a,b,c,d){var f={eulas:"required",shopid:0,units:0,required:0,assigned:0,endusermobilephonerequired:0,strings:[],init:function init(c){d.get_strings([{key:"invalidemail",component:"local_shop"},{key:"notallassigned",component:"local_shop"},{key:"continue",component:"local_shop"},{key:"emptyorder",component:"local_shop"}]).done(function(a){f.strings=a});a(".shop-description-toggle").bind("click",this.toggle_description);a(".local-shop-detail-delete").bind("click",this.clear_product);a(".local-shop-order-detail").bind("change",this.update_product);a(".local-shop-password").bind("keypress",this.check_pass_code);a(".local-shop-email").bind("change",this.check_email);a(".local-shop-add-unit").bind("click",this.add_unit);a(".local-shop-delete-unit").bind("click",this.delete_unit);a(".local-shop-add-assign").bind("change",this.add_assign);a(".local-shop-delete-assign").bind("click",this.delete_assign);a(".local-shop-toggle-invoiceinfo").bind("change",this.toggle_invoiceinfo);a(".local-shop-delete-user").bind("click",this.delete_user);a(".local-shop-add-user").bind("click",this.add_user);if(c){f.shopid=c.shopid;f.units=c.units;f.required=c.required;f.assigned=c.assigned;f.endusermobilephonerequired=c.endusermobilephonerequired}b.debug("AMD Local Shop Front initialized")},initeulas:function initeulas(c){a("#shop-eula-confirm").bind("click",this.accept_eulas);if(c){if("required"===c.eulas){a("#region-pre").css("display","none")}f.eulas=c.eulas}b.debug("AMD Local Shop Front Eulas initialized")},toggle_description:function toggle_description(){var b=a(this);if(b.attr("src").match("/open/")){b.attr("src",b.attr("src").replace("open","close"));b.parent().parent().children(".shop-front-description").removeClass("shop-desc-gradient")}else{b.attr("src",b.attr("src").replace("close","open"));b.parent().parent().children(".shop-front-description").addClass("shop-desc-gradient")}},toggle_invoiceinfo:function toggle_invoiceinfo(){var b;if(this.checked){a("#shop-invoiceinfo-wrapper").css("display","block");if(""==document.driverform.elements["invoiceinfo::organisation"].value){b=document.driverform.elements["invoiceinfo::organisation"];b.value=document.driverform.elements["customerinfo::organisation"].value}if(""==document.driverform.elements["invoiceinfo::city"].value){b=document.driverform.elements["invoiceinfo::city"];b.value=document.driverform.elements["customerinfo::city"].value}}else{a("#shop-invoiceinfo-wrapper").css("display","none")}},accept_eulas:function accept_eulas(){var b;if(1==a("#shop-agreeeula").val()){a("#euladiv").css("display","none");a("#order").css("display","block");a("#order").css("visibility","show");a("#region-pre").css("display","block");a("#region-pre").css("visibility","show");b=c.wwwroot+"/local/shop/front/ajax/service.php";b+="?what=agreeeulas";b+="&service=order";b+="&id="+f.shopid}else{b=c.wwwroot+"/local/shop/front/ajax/service.php";b+="?what=reseteulas";b+="&service=order";b+="&id="+f.shopid}a.get(b)},reset_eulas:function reset_eulas(){if("agreed"==f.eulas){var b=c.wwwroot+"/local/shop/front/ajax/service.php";b+="?what=reseteulas";b+="&service=order";b+="&id="+f.shopid;a.get(b)}},add_assign:function add_assign(){var b=a(this),d=b.attr("data-role"),e=b.attr("data-product"),g=c.wwwroot+"/local/shop/front/ajax/service.php",h=b.attr("data-requiredroles").split(","),i,j;for(j in h){i=h[j];a("#addassign"+i+"list"+e).html(f.waiter())}a.post(g,{id:f.shopid,service:"users",what:"addassign",role:d,product:e,participantid:this.options[this.selectedIndex].value},function(b){var c=JSON.parse(b);for(j in h){i=h[j];a("#addassign"+i+"list"+e).html(c.content[i])}f.assigned++;if(f.assigned<f.required){a("#next-button").css("opacity","0.5");a("#next-button").removeClass("shop-active-button");a("#next-button").attr("disabled","disabled");a("#next-button").attr("title",f.strings[1])}else{a("#next-button").css("opacity","1.0");a("#next-button").addClass("shop-active-button");a("#next-button").attr("disabled",null);a("#next-button").attr("title",f.strings[2])}},"html")},delete_assign:function delete_assign(b,d,e){var g=a(this),b=g.attr("data-role"),d=g.attr("data-product"),e=g.attr("data-email"),h=c.wwwroot+"/local/shop/front/ajax/service.php",i=g.attr("data-requiredroles").split(","),j,k;for(k in i){j=i[k];a("#assignrole"+j+"list"+d).html(f.waiter())}a.post(h,{id:f.shopid,service:"users",what:"deleteassign",role:b,product:d,participantid:e},function(b){var c=JSON.parse(b);for(k in i){j=i[k];a("#assignrole"+j+"list"+d).html(c.content[j])}f.assigned--;if(0>f.assigned){f.assigned=0}if(f.assigned<f.required){a("#next-button").css("opacity","0.5");a("#next-button").removeClass("shop-active-button");a("#next-button").attr("disabled","disabled");a("#next-button").attr("title",f.strings[1])}else{a("#next-button").css("opacity","1.0");a("#next-button").addClass("shop-active-button");a("#next-button").attr("disabled",null);a("#next-button").attr("title",f.strings[2])}},"html")},add_unit:function add_unit(d){d.stopPropagation();d.preventDefault();var e=a(this),g=e.attr("data-product"),h=c.wwwroot+"/local/shop/front/ajax/service.php";a("#bag_"+g).html(f.waiter());a.post(h,{id:f.shopid,service:"shop",what:"addunit",productname:g},function(c){var d=JSON.parse(c);a("#bag_"+g).html(d.html);f.update_details();f.update_totals();var h=e.attr("data-maxquant");b.debug(h+">="+d.quant);if(0<h&&d.quant>=h){a("#ci-"+g).attr("disabled","disabled");a("#cimod-"+g).attr("disabled","disabled")}},"html");f.units++;a("#next-button").attr("disabled",null);a("#next-button").addClass("shop-active-button");a("#next-button").css("opacity","1.0");a("#next-button").attr("title",f.strings[2])},delete_unit:function delete_unit(d){d.stopPropagation();d.preventDefault();var e=a(this),g=e.attr("data-product"),h=c.wwwroot+"/local/shop/front/ajax/service.php";a("#bag_"+g).html(f.waiter());a.post(h,{id:f.shopid,service:"shop",what:"deleteunit",productname:g,clearall:0},function(c){var d=JSON.parse(c);a("#bag_"+g).html(d.html);f.update_details();f.update_totals();b.debug("enabling product add button "+g);a("#ci-"+g).attr("disabled",null);a("#cimod-"+g).attr("disabled",null)},"html");f.units--;if(0==f.units){a("#next-button").attr("disabled","disabled");a("#next-button").removeClass("shop-active-button");a("#next-button").css("opacity","0.5");a("#next-button").attr("title",f.strings[3])}},clear_product:function clear_product(b){b.stopPropagation();b.preventDefault();var d=a(this),e=d.attr("data-product"),g=c.wwwroot+"/local/shop/front/ajax/service.php";a("#bag_"+e).html(f.waiter());a("#id_"+e).val(0);a("#ci-"+e).attr("disabled",null);a("#id_total_"+e).val(0);a.post(g,{id:f.shopid,service:"shop",what:"deleteunit",productname:e,clearall:1},function(b){var c=JSON.parse(b);a("#bag_"+e).html(c.html);f.update_details();f.update_totals()},"html")},update_product:function update_product(b){b.stopPropagation();b.preventDefault();var d=a(this),e=d.attr("data-product"),g=d.attr("data-maxquant"),h=c.wwwroot+"/local/shop/front/ajax/service.php",i=a("#id_"+e).val();if(0<g&&i>g){i=g}a("#id_"+e).val(i);a("#bag_"+e).html(f.waiter());a.post(h,{id:f.shopid,service:"shop",what:"setunits",productname:e,quant:i},function(b){var c=JSON.parse(b);a("#bag_"+e).html(c.html);f.update_details();f.update_totals()},"html")},update_totals:function update_totals(){var b=c.wwwroot+"/local/shop/front/ajax/service.php";a("#shop-ordertotals").html(f.waiter());a.post(b,{id:f.shopid,service:"shop",what:"ordertotals"},function(b){var c=JSON.parse(b);a("#shop-ordertotals").html(c.html);a(".local-shop-detail-delete").unbind("click");a(".local-shop-detail-delete").bind("click",f.clear_product);a(".local-shop-order-detail").unbind("change");a(".local-shop-order-detail").bind("change",f.update_product)},"html")},update_details:function update_details(){var b=c.wwwroot+"/local/shop/front/ajax/service.php";a("#order-detail").html(f.waiter());a.post(b,{id:f.shopid,service:"shop",what:"orderdetails"},function(b){var c=JSON.parse(b);a("#order-detail").html(c.html);a(".local-shop-delete-unit").unbind("click");a(".local-shop-delete-unit").bind("click",f.delete_unit)},"html")},add_user:function add_user(){var b=a(this),d=document.forms.participant,e=c.wwwroot+"/local/shop/front/ajax/service.php",g=b.attr("data-requiredroles"),h=g.split(","),i=b.attr("data-products"),k=i.split(","),l={};l.lastname=d.lastname.value;l.firstname=d.firstname.value;l.email=d.email.value;l.city=d.city.value;if(!f.enduserorganisationrequired){l.institution=d.institution.value}if(!f.endusermobilephonerequired){l.phone2=d.phone2.value}a("#participantlist").html(f.waiter());a.post(e,{id:f.shopid,service:"users",what:"addparticipant",participant:JSON.stringify(l),roles:JSON.stringify(h)},function(c){var d,g,l;a("#participantlist").html(c);a(".local-shop-delete-user").unbind("click");a(".local-shop-delete-user").bind("click",f.delete_user);d=document.forms.participant;d.lastname.value="";d.firstname.value="";d.email.value="";if(!f.endusermobilephonerequired){d.phone2.value=""}var m=b.attr("data-availableseats");m--;b.attr("data-availableseats",m);if(0===m){b.attr("disabled","disabled")}for(g=0;g<h.length;g++){for(l=0;l<k.length;l++){a("#"+h[g]+"list"+k[l]).html(f.waiter())}}a.post(e,{id:f.shopid,service:"users",what:"assignalllistobj"},function(b){var c,d,e,f,g,l;g=JSON.parse(b);for(c=0;c<h.length;c++){e=h[c];for(d=0;d<k.length;d++){f=k[d];l=g.content[e][f];a("#"+e+"list"+f).html(l)}}a(".local-shop-add-assign").unbind("change");a(".local-shop-add-assign").bind("change",this.add_assign)},"html")},"html")},delete_user:function delete_user(){var b=a(this),d=b.attr("data-ptmail"),e=c.wwwroot+"/local/shop/front/ajax/service.php",g=b.attr("data-requiredroles"),h=g.split(","),i=b.attr("data-products"),k=i.split(",");a("#participantlist").html(f.waiter());a.post(e,{id:f.shopid,service:"users",what:"deleteparticipant",participantid:d,roles:JSON.stringify(h)},function(c){var d,g;a("#participantlist").html(c);a(".local-shop-delete-user").unbind("click");a(".local-shop-delete-user").bind("click",f.delete_user);var l=b.attr("data-availableseats");b.attr("data-availableseats",l+1);b.attr("disabled",null);a("#addparticipant-line").css("display","block");for(d=0;d<h.length;d++){for(g=0;g<k.length;g++){a("#"+h[d]+"list"+k[g]).html(f.waiter())}}a.post(e,{id:f.shopid,service:"users",what:"assignalllistobj"},function(b){var c,d,e,f,g,l;g=JSON.parse(b);for(c=0;c<h.length;c++){e=h[c];for(d=0;d<k.length;d++){f=k[d];l=g.content[e][f];a("#"+e+"list"+f).html(l)}}a(".local-shop-add-assign").unbind("change");a(".local-shop-add-assign").bind("change",this.add_assign)},"html")})},check_pass_code:function check_pass_code(b){var d=a(this),e=d.attr("data-product"),g=c.wwwroot+"/local/shop/front/ajax/service.php",h="<img width=\"14\" height=\"14\" src=\""+c.wwwroot+"/local/shop/pix/ajaxloader.gif\" />",i="<img width=\"14\" height=\"14\" src=\""+c.wwwroot+"/local/shop/pix/valid.png\" />",j="<img width=\"14\" height=\"14\" src=\""+c.wwwroot+"/local/shop/pix/invalid.png\" />";a("#ci-pass-status-"+e).html(h);a("#cimod-pass-status-"+e).html(h);var k=d.val()+b.key;a.post(g,{id:f.shopid,service:"shop",what:"checkpasscode",productname:e,passcode:k},function(b){var c=JSON.parse(b);if("passed"==c.status){a("#ci-"+e).attr("disabled",null);a("#ci-pass-status-"+e).html(i);a("#cimod-"+e).attr("disabled",null);a("#cimod-pass-status-"+e).html(i)}else{a("#ci-pass-status-"+e).html(j);a("#cimod-pass-status-"+e).html(j)}},"html")},check_email:function check_email(){var b=a(this);if(/^\w+([\.+-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(b.val())){return!0}alert(f.strings[0]);b.val("");return!1},waiter:function waiter(){return"<div class=\"ajax-waiter\"><center><img src=\""+c.wwwroot+"/local/shop/pix/loading29.gif\" /><center></div>"},open_popup:function open_popup(b){var c=a(this),b=c.attr("data-target");window.open(b,"product","width=400,height=500,toolbar=0,menubar=0,statusbar=0")},openSalesPopup:function openSalesPopup(){window.open(c.wwwroot+"/local/shop/popup.php?p=sales","sales","width=600,height=600,toolbar=0,menubar=0,statusbar=0, resizable=1,scrollbars=1")}};return f});
//# sourceMappingURL=front.min.js.map
>>>>>>> MOODLE_40_STABLE
=======
define("local_shop/front",["jquery","core/log","core/config","core/str"],(function($,log,cfg,str){var shopfront={eulas:"required",shopid:0,units:0,required:0,assigned:0,endusermobilephonerequired:0,strings:[],init:function(params){str.get_strings([{key:"invalidemail",component:"local_shop"},{key:"notallassigned",component:"local_shop"},{key:"continue",component:"local_shop"},{key:"emptyorder",component:"local_shop"}]).done((function(s){shopfront.strings=s})),$(".shop-description-toggle").bind("click",this.toggle_description),$(".local-shop-detail-delete").bind("click",this.clear_product),$(".local-shop-order-detail").bind("change",this.update_product),$(".local-shop-password").bind("keypress",this.check_pass_code),$(".local-shop-email").bind("change",this.check_email),$(".local-shop-add-unit").bind("click",this.add_unit),$(".local-shop-delete-unit").bind("click",this.delete_unit),$(".local-shop-add-assign").bind("change",this.add_assign),$(".local-shop-delete-assign").bind("click",this.delete_assign),$(".local-shop-toggle-invoiceinfo").bind("change",this.toggle_invoiceinfo),$(".local-shop-delete-user").bind("click",this.delete_user),$(".local-shop-add-user").bind("click",this.add_user),params&&(shopfront.shopid=params.shopid,shopfront.units=params.units,shopfront.required=params.required,shopfront.assigned=params.assigned,shopfront.endusermobilephonerequired=params.endusermobilephonerequired),log.debug("AMD Local Shop Front initialized")},initeulas:function(params){$("#shop-eula-confirm").bind("click",this.accept_eulas),params&&("required"===params.eulas&&$("#region-pre").css("display","none"),shopfront.eulas=params.eulas),log.debug("AMD Local Shop Front Eulas initialized")},toggle_description:function(){var that=$(this);that.attr("src").match("/open/")?(that.attr("src",that.attr("src").replace("open","close")),that.parent().parent().children(".shop-front-description").removeClass("shop-desc-gradient")):(that.attr("src",that.attr("src").replace("close","open")),that.parent().parent().children(".shop-front-description").addClass("shop-desc-gradient"))},toggle_invoiceinfo:function(){this.checked?($("#shop-invoiceinfo-wrapper").css("display","block"),""==document.driverform.elements["invoiceinfo::organisation"].value&&(document.driverform.elements["invoiceinfo::organisation"].value=document.driverform.elements["customerinfo::organisation"].value),""==document.driverform.elements["invoiceinfo::city"].value&&(document.driverform.elements["invoiceinfo::city"].value=document.driverform.elements["customerinfo::city"].value)):$("#shop-invoiceinfo-wrapper").css("display","none")},accept_eulas:function(){var url;1==$("#shop-agreeeula").val()?($("#euladiv").css("display","none"),$("#order").css("display","block"),$("#order").css("visibility","show"),$("#region-pre").css("display","block"),$("#region-pre").css("visibility","show"),url=cfg.wwwroot+"/local/shop/front/ajax/service.php",url+="?what=agreeeulas",url+="&service=order",url+="&id="+shopfront.shopid):(url=cfg.wwwroot+"/local/shop/front/ajax/service.php",url+="?what=reseteulas",url+="&service=order",url+="&id="+shopfront.shopid),$.get(url)},reset_eulas:function(){if("agreed"==shopfront.eulas){var url=cfg.wwwroot+"/local/shop/front/ajax/service.php";url+="?what=reseteulas",url+="&service=order",url+="&id="+shopfront.shopid,$.get(url)}},add_assign:function(){var role,rix,that=$(this),assignrole=that.attr("data-role"),product=that.attr("data-product"),urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php",requiredroles=that.attr("data-requiredroles").split(",");for(rix in requiredroles)role=requiredroles[rix],$("#addassign"+role+"list"+product).html(shopfront.waiter());$.post(urlbase,{id:shopfront.shopid,service:"users",what:"addassign",role:assignrole,product:product,participantid:this.options[this.selectedIndex].value},(function(data){var rolestubs=JSON.parse(data);for(rix in requiredroles)role=requiredroles[rix],$("#addassign"+role+"list"+product).html(rolestubs.content[role]);shopfront.assigned++,shopfront.assigned<shopfront.required?($("#next-button").css("opacity","0.5"),$("#next-button").removeClass("shop-active-button"),$("#next-button").attr("disabled","disabled"),$("#next-button").attr("title",shopfront.strings[1])):($("#next-button").css("opacity","1.0"),$("#next-button").addClass("shop-active-button"),$("#next-button").attr("disabled",null),$("#next-button").attr("title",shopfront.strings[2]))}),"html")},delete_assign:function(assignrole,product,email){var role,rix,that=$(this),urlbase=(assignrole=that.attr("data-role"),product=that.attr("data-product"),email=that.attr("data-email"),cfg.wwwroot+"/local/shop/front/ajax/service.php"),requiredroles=that.attr("data-requiredroles").split(",");for(rix in requiredroles)role=requiredroles[rix],$("#assignrole"+role+"list"+product).html(shopfront.waiter());$.post(urlbase,{id:shopfront.shopid,service:"users",what:"deleteassign",role:assignrole,product:product,participantid:email},(function(data){var rolestubs=JSON.parse(data);for(rix in requiredroles)role=requiredroles[rix],$("#assignrole"+role+"list"+product).html(rolestubs.content[role]);shopfront.assigned--,shopfront.assigned<0&&(shopfront.assigned=0),shopfront.assigned<shopfront.required?($("#next-button").css("opacity","0.5"),$("#next-button").removeClass("shop-active-button"),$("#next-button").attr("disabled","disabled"),$("#next-button").attr("title",shopfront.strings[1])):($("#next-button").css("opacity","1.0"),$("#next-button").addClass("shop-active-button"),$("#next-button").attr("disabled",null),$("#next-button").attr("title",shopfront.strings[2]))}),"html")},add_unit:function(e){e.stopPropagation(),e.preventDefault();var that=$(this),productname=that.attr("data-product"),urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php";$("#bag_"+productname).html(shopfront.waiter());var seoalias=that.attr("data-seoalias");if(seoalias){var touchurl=cfg.wwwroot+"/local/shop/pro/front/product/"+seoalias+"/add";$.get(touchurl)}$.post(urlbase,{id:shopfront.shopid,service:"shop",what:"addunit",productname:productname},(function(data){var dataobj=JSON.parse(data);$("#bag_"+productname).html(dataobj.html),shopfront.update_details(),shopfront.update_totals();var maxquant=that.attr("data-maxquant");log.debug(maxquant+">="+dataobj.quant),maxquant>0&&dataobj.quant>=maxquant&&($("#ci-"+productname).attr("disabled","disabled"),$("#cimod-"+productname).attr("disabled","disabled"))}),"html"),shopfront.units++,$("#next-button").attr("disabled",null),$("#next-button").addClass("shop-active-button"),$("#next-button").css("opacity","1.0"),$("#next-button").attr("title",shopfront.strings[2])},delete_unit:function(e){e.stopPropagation(),e.preventDefault();var that=$(this),productname=that.attr("data-product"),urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php";$("#bag_"+productname).html(shopfront.waiter());var seoalias=that.attr("data-seoalias");if(seoalias){var touchurl=cfg.wwwroot+"/local/shop/pro/front/product/"+seoalias+"/delete";$.get(touchurl)}$.post(urlbase,{id:shopfront.shopid,service:"shop",what:"deleteunit",productname:productname,clearall:0},(function(data){var dataobj=JSON.parse(data);$("#bag_"+productname).html(dataobj.html),shopfront.update_details(),shopfront.update_totals(),log.debug("enabling product add button "+productname),$("#ci-"+productname).attr("disabled",null),$("#cimod-"+productname).attr("disabled",null)}),"html"),shopfront.units--,0==shopfront.units&&($("#next-button").attr("disabled","disabled"),$("#next-button").removeClass("shop-active-button"),$("#next-button").css("opacity","0.5"),$("#next-button").attr("title",shopfront.strings[3]))},clear_product:function(e){e.stopPropagation(),e.preventDefault();var that=$(this),productname=that.attr("data-product"),urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php";$("#bag_"+productname).html(shopfront.waiter());var seoalias=that.attr("data-seoalias");if(seoalias){var touchurl=cfg.wwwroot+"/local/shop/pro/front/product/"+seoalias+"/deleteall";$.get(touchurl)}$("#id_"+productname).val(0),$("#ci-"+productname).attr("disabled",null),$("#id_total_"+productname).val(0),$.post(urlbase,{id:shopfront.shopid,service:"shop",what:"deleteunit",productname:productname,clearall:1},(function(data){var dataobj=JSON.parse(data);$("#bag_"+productname).html(dataobj.html),shopfront.update_details(),shopfront.update_totals()}),"html")},update_product:function(e){e.stopPropagation(),e.preventDefault();var that=$(this),productname=that.attr("data-product"),maxquant=that.attr("data-maxquant"),urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php",currentval=$("#id_"+productname).val();maxquant>0&&currentval>maxquant&&(currentval=maxquant),$("#id_"+productname).val(currentval),$("#bag_"+productname).html(shopfront.waiter()),$.post(urlbase,{id:shopfront.shopid,service:"shop",what:"setunits",productname:productname,quant:currentval},(function(data){var dataobj=JSON.parse(data);$("#bag_"+productname).html(dataobj.html),shopfront.update_details(),shopfront.update_totals()}),"html")},update_totals:function(){var urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php";$("#shop-ordertotals").html(shopfront.waiter()),$.post(urlbase,{id:shopfront.shopid,service:"shop",what:"ordertotals"},(function(data){var dataobj=JSON.parse(data);$("#shop-ordertotals").html(dataobj.html),$(".local-shop-detail-delete").unbind("click"),$(".local-shop-detail-delete").bind("click",shopfront.clear_product),$(".local-shop-order-detail").unbind("change"),$(".local-shop-order-detail").bind("change",shopfront.update_product)}),"html")},update_details:function(){var urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php";$("#order-detail").html(shopfront.waiter()),$.post(urlbase,{id:shopfront.shopid,service:"shop",what:"orderdetails"},(function(data){var dataobj=JSON.parse(data);$("#order-detail").html(dataobj.html),$(".local-shop-delete-unit").unbind("click"),$(".local-shop-delete-unit").bind("click",shopfront.delete_unit)}),"html")},add_user:function(){var that=$(this),formobj=document.forms.participant,urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php",roles=that.attr("data-requiredroles").split(","),products=that.attr("data-products").split(","),pt=new Object;pt.lastname=formobj.lastname.value,pt.firstname=formobj.firstname.value,pt.email=formobj.email.value,pt.city=formobj.city.value,shopfront.enduserorganisationrequired||(pt.institution=formobj.institution.value),shopfront.endusermobilephonerequired||(pt.phone2=formobj.phone2.value),$("#participantlist").html(shopfront.waiter()),$.post(urlbase,{id:shopfront.shopid,service:"users",what:"addparticipant",participant:JSON.stringify(pt),roles:JSON.stringify(roles)},(function(data){var formobj,i,j;$("#participantlist").html(data),$(".local-shop-delete-user").unbind("click"),$(".local-shop-delete-user").bind("click",shopfront.delete_user),(formobj=document.forms.participant).lastname.value="",formobj.firstname.value="",formobj.email.value="",shopfront.endusermobilephonerequired||(formobj.phone2.value="");var availables=that.attr("data-availableseats");for(availables--,that.attr("data-availableseats",availables),0===availables&&that.attr("disabled","disabled"),i=0;i<roles.length;i++)for(j=0;j<products.length;j++)$("#"+roles[i]+"list"+products[j]).html(shopfront.waiter());$.post(urlbase,{id:shopfront.shopid,service:"users",what:"assignalllistobj"},(function(data){var i,j,r,p,obj,html;for(obj=JSON.parse(data),i=0;i<roles.length;i++)for(r=roles[i],j=0;j<products.length;j++)p=products[j],html=obj.content[r][p],$("#"+r+"list"+p).html(html);$(".local-shop-add-assign").unbind("change"),$(".local-shop-add-assign").bind("change",this.add_assign)}),"html")}),"html")},delete_user:function(){var that=$(this),ptmail=that.attr("data-ptmail"),urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php",roles=that.attr("data-requiredroles").split(","),products=that.attr("data-products").split(",");$("#participantlist").html(shopfront.waiter()),$.post(urlbase,{id:shopfront.shopid,service:"users",what:"deleteparticipant",participantid:ptmail,roles:JSON.stringify(roles)},(function(data){var i,j;$("#participantlist").html(data),$(".local-shop-delete-user").unbind("click"),$(".local-shop-delete-user").bind("click",shopfront.delete_user);var availables=that.attr("data-availableseats");for(that.attr("data-availableseats",availables+1),that.attr("disabled",null),$("#addparticipant-line").css("display","block"),i=0;i<roles.length;i++)for(j=0;j<products.length;j++)$("#"+roles[i]+"list"+products[j]).html(shopfront.waiter());$.post(urlbase,{id:shopfront.shopid,service:"users",what:"assignalllistobj"},(function(data){var i,j,r,p,obj,html;for(obj=JSON.parse(data),i=0;i<roles.length;i++)for(r=roles[i],j=0;j<products.length;j++)p=products[j],html=obj.content[r][p],$("#"+r+"list"+p).html(html);$(".local-shop-add-assign").unbind("change"),$(".local-shop-add-assign").bind("change",this.add_assign)}),"html")}))},check_pass_code:function(e){var that=$(this),productname=that.attr("data-product"),urlbase=cfg.wwwroot+"/local/shop/front/ajax/service.php",ajax_waiter_img='<img width="14" height="14" src="'+cfg.wwwroot+'/local/shop/pix/ajaxloader.gif" />',ajax_success_img='<img width="14" height="14" src="'+cfg.wwwroot+'/local/shop/pix/valid.png" />',ajax_failure_img='<img width="14" height="14" src="'+cfg.wwwroot+'/local/shop/pix/invalid.png" />';$("#ci-pass-status-"+productname).html(ajax_waiter_img),$("#cimod-pass-status-"+productname).html(ajax_waiter_img);var input=that.val()+e.key;$.post(urlbase,{id:shopfront.shopid,service:"shop",what:"checkpasscode",productname:productname,passcode:input},(function(data){"passed"==JSON.parse(data).status?($("#ci-"+productname).attr("disabled",null),$("#ci-pass-status-"+productname).html(ajax_success_img),$("#cimod-"+productname).attr("disabled",null),$("#cimod-pass-status-"+productname).html(ajax_success_img)):($("#ci-pass-status-"+productname).html(ajax_failure_img),$("#cimod-pass-status-"+productname).html(ajax_failure_img))}),"html")},check_email:function(){var that=$(this);return!!/^\w+([\.+-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(that.val())||(alert(shopfront.strings[0]),that.val(""),!1)},waiter:function(){return'<div class="ajax-waiter"><center><img src="'+cfg.wwwroot+'/local/shop/pix/loading29.gif" /><center></div>'},open_popup:function(target){target=$(this).attr("data-target");window.open(target,"product","width=400,height=500,toolbar=0,menubar=0,statusbar=0")},openSalesPopup:function(){window.open(cfg.wwwroot+"/local/shop/popup.php?p=sales","sales","width=600,height=600,toolbar=0,menubar=0,statusbar=0, resizable=1,scrollbars=1")}};return shopfront}));

//# sourceMappingURL=front.min.js.map
>>>>>>> MOODLE_401_STABLE
